# 트랜잭션과 무결성

- 트랜잭션
    - DB에서 하나의 논리적 기능을 수행하기 위해
    - 여러 개의 쿼리들을 하나로 묶은 작업 단위
- 트랜잭션의 특징 (ACID)
  - **원자성 (Atomicity)**
    - 한 트랜잭션과 관련된 일이 `모두 수행되었거나 / 되지 않았거나`를 보장
    - all or nothing
  - **일관성 (Consistency)**
    - `DB의 제약이나 규칙에 따라` 데이터를 변경해야 하는 것 
  - **격리성 (Isolation)**
    - 모든 트랜잭션은 `다른 트랜잭션으로부터 독립`되어야 한다
    - 수행 시 서로 끼어들지 x, 마치 순차적으로 실행되는 것처럼 작동
    - 격리수준
      1. SERIALIZABLE
      2. REPEATABLE_READ
      3. READ_COMMITTED
      4. READ_UNCOMMITTED
  - **지속성 (Durability)**
    - `커밋된 트랜잭션은 그 결과가 영구적으로 DB에 반영`되어야 함
    - 중간에 시스템 문제가 발생해도 성공한 트랜잭션을 복구하는 기능이 있음을 의미
    - 체크섬, 저널링, 롤백..

---
💡 커밋과 롤백
- 커밋 : 하나의 트랜잭션이 성공적으로 수행되었음을 의미
- 롤백 : 트랜잭션으로 처리한 하나의 묶음 과정을 취소함을 의미

💡트랜잭션 전파
- 트랜잭션은 커넥션 단위로 수행되기 때문에, 커넥션 객체를 넘겨 수행해야함 -> 매번 넘겨주기는 귀찮다
- 따라서 여러 트랜잭션 관련 메서드의 호출을 하나의 트랜잭션에 묶이도록 하는 것 -> 트랜잭션 전파
- Spring 프레임워크에서는 @Transctional 애너테이션으로 여러 쿼리 관련 코드를 하나의 트랜잭션으로 처리
---

### 무결성
- 데이터의 정확성, 일관성, 유효성을 유지하는 것
- 데이터의 무결성을 유지하는 것은 DBMS의 중요 기능
  - 주로 데이터에 적용되는 연산에 제한을 두어 데이터의 무결성을 유지


- 무결성의 종류
  1. 개체 무결성
     - 기본키로 선택된 필드는 빈값을 허용X
  2. 참조 무결성
     - 서로 참조 관계에 있는 두 테이블의 데이터는 항상 일관된 값 유지
     - 예시
       - 부모 테이블의 데이터가 삭제될 때 자식 테이블의 데이터도 함께 삭제되거나,
       - 삭제가 불가능하게 설정 가능
  3. 고유 무결성
     - 특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우
     - 그 속성 값은 모두 고유한 값을 가진다
  4. NULL 무결성
    - 특정 속성에 NULL이 올 수 없다고 조건이 주어진 경우
    - 그 속성 값은 NULL이 될 수 없다
---

- 참고 
  - https://f-lab.kr/insight/understanding-foreign-keys-and-referential-integrity-20240820
